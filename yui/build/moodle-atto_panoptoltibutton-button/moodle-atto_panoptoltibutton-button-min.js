YUI.add("moodle-atto_panoptoltibutton-button",function(e,t){e.namespace("M.atto_panoptoltibutton").PlacementStrategyFactory=function(){this.strategyFor=function(t,n,r,i,s){var o=e.M.atto_panoptoltibutton.EmbeddedContentRenderingStrategy;if(t.mediaType==="application/vnd.ims.lti.v1.ltilink"||t.placementAdvice){o=e.M.atto_panoptoltibutton.IframeRenderingStrategy;if(t.placementAdvice)switch(t.placementAdvice.presentationDocumentTarget){case"iframe":o=e.M.atto_panoptoltibutton.IframeRenderingStrategy;break;case"embed":case"frame":case"window":case"popup":case"overlay":o=e.M.atto_panoptoltibutton.EmbeddedContentRenderingStrategy;break;default:alert("Unsupported presentation target: "+t.placementAdvice.presentationDocumentTarget)}}var u=new o(t,n,r,i,s);return u}},e.namespace("M.atto_panoptoltibutton").EmbeddedContentRenderingStrategy=function(t,n,r,i,s){var o=t.mediaType.split("/"),u=o[0],a="250px",f=128,l=72,c=l,h=null,p=parseInt(a)-parseInt(l)+"px",d,v;if(!t.text||!t.text.length)a=l+"px";t.displayHeight||(t.displayHeight=a),t.thumbnail&&(t.thumbnail.width||(t.thumbnail.width=f),t.thumbnail.height||(t.thumbnail.height=l),t.displayWidth&&(h=parseInt(t.displayWidth)-parseInt(t.thumbnail.width)-5+"px"),c=parseInt(t.thumbnail.height)+"px"),d={ltiLink:e.Handlebars.compile('<iframe src="'+s+"/lib/editor/atto/plugins/panoptoltibutton/view.php?custom={{custom}}&"+"course={{course.id}}&ltitypeid={{toolid}}&resourcelinkid={{resourcelinkid}}"+"{{#if item.url}}&contenturl={{item.url}}{{/if}}"+'" '+'{{#if item.placementAdvice.width}} width="{{item.placementAdvice.displayWidth}}"{{/if}} '+'{{#if item.placementAdvice.height}} height="{{item.placementAdvice.displayHeight}}"{{/if}} '+"/>"),link:e.Handlebars.compile('<div style="'+(t.displayWidth?"width:{{item.displayWidth}};":"")+'height:{{titleHeight}};">'+'<a href="'+s+"/lib/editor/atto/plugins/panoptoltibutton/view.php?custom={{custom}}&"+"course={{course.id}}&ltitypeid={{toolid}}&resourcelinkid={{resourcelinkid}}"+"{{#if item.url}}&contenturl={{item.url}}{{/if}}"+'" '+'{{#if item.placementAdvice.windowTarget}}target="{{item.placementAdvice.windowTarget}}" {{/if}}'+">"+"{{#if item.thumbnail}}"+'<img src={{item.thumbnail.id}} alt="content thumbnail"'+'style="float:left;margin-right:5px;'+"width:{{item.thumbnail.width}}px;"+"height:{{item.thumbnail.height}}px;"+'" /> '+"{{/if}}"+'<div style="float:left;font-size:20px;font-weight:bold;'+(t.titleWidth?"width:{{titleWidth}};":"")+'height:{{titleHeight}};line-height:{{titleHeight}};">'+"{{item.title}}"+"</div>"+"</a>"+"</div>"+"{{#if item.text}}"+'<div style="'+(t.displayWidth?"width:{{item.displayWidth}};":"")+'min-height:{{textHeight}};"></span>{{item.text}}</span></div>'+"{{/if}}")};switch(u){case"application":o[1]==="vnd.ims.lti.v1.ltilink"?v=d.ltiLink({item:t,toolid:i.id,resourcelinkid:r,course:n}):alert("Unsupported application subtype");break;case"text":v=d.link({item:t,custom:encodeURIComponent(JSON.stringify(t.custom)),course:n,toolid:i.id,resourcelnkid:r,textHeight:p,titleHeight:c,titleWidth:h});break;default:alert("Unsupported type")}this.toHtml=function(){return v}},e.namespace("M.atto_panoptoltibutton").IframeRenderingStrategy=function(t,n,r,i,s){var o;t.url!==i.baseurl&&t.url!==i.config.toolurl_ContentItemSelectionRequest&&(t.useCustomUrl=!0),o=e.Handlebars.compile('<iframe src="'+s+"/lib/editor/atto/plugins/panoptoltibutton/view.php?course={{courseId}}"+"&ltitypeid={{ltiTypeId}}&custom={{custom}}"+"{{#if item.useCustomUrl}}&contenturl={{item.url}}{{/if}}"+'&resourcelinkid={{resourcelinkid}}" '+' {{#if item.placementAdvice.displayWidth}}width="{{item.placementAdvice.displayWidth}}" {{/if}}'+' {{#if item.placementAdvice.displayHeight}}height="{{item.placementAdvice.displayHeight}}" {{/if}}'+"></iframe>"),this.toHtml=function(){return o({item:t,custom:JSON.stringify(t.custom),courseId:n.id,resourcelinkid:r,ltiTypeId:i.id})}},require(["core/str"],function(e){var t=null,n=e.get_string("erroroccurred","atto_panoptoltibutton");$.when(n).done(function(e){t=e}),document.CALLBACKS={handleError:function(e){alert(t);for(var n=0;n<e.length;n++)console.error(e[n])}}}),e.namespace("M.atto_panoptoltibutton").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_CREATEACTIVITYURL:"/lib/editor/atto/plugins/panoptoltibutton/view.php",_CONTENT_ITEM_SELECTION_URL:"/lib/editor/atto/plugins/panoptoltibutton/contentitem.php",_panel:null,_addTool:function(t,n){t.preventDefault();var r=this._createResourceLinkId(),i=this.get("host"),s,o=this._course;wwwroot=this._wwwroot,document.CALLBACKS["f"+r]=function(t){if(!t)return;for(var u=0;u<t["@graph"].length;u++){var a=t["@graph"][u],f=new e.M.atto_panoptoltibutton.PlacementStrategyFactory,l=f.strategyFor(a,o,r,n,wwwroot),c=l.toHtml;i.insertContentAtFocusPoint(c(a))}i.saveSelection(),i.updateOriginal(),s.hide(),s.destroy()},this._panel=new M.core.dialogue({bodyContent:'<iframe src="'+wwwroot+this._CONTENT_ITEM_SELECTION_URL+"?course="+this._course.id+"&id="+n.id+"&callback=f"+r+'" width="100%" height="100%"></iframe>',headerContent:n.name,width:"67%",height:"66%",draggable:!1,visible:!0,zindex:100,modal:!0,focusOnPreviousTargetAfterHide:!0,render:!0}),this._panel.after("visibleChange",this._panel.destroy,this),s=this._panel},initializer:function(e){if(!e.toolTypes||e.toolTypes.length===0)return;this._course=e.course,this._wwwroot=e.wwwroot,this._createResourceLinkId=function(e){return function(){return e+"_"+(new Date).getTime()}}(e.resourcebase),this.addToolbarMenu({icon:"ed/iconone",iconComponent:"atto_panoptoltibutton",globalItemConfig:{callback:this._addTool},items:e.toolTypes.map(function(e){return{text:e.name,callbackArgs:e}})})}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
