
var __cov_tQvJxwNO$_8wl04w8isVPA = (Function('return this'))();
if (!__cov_tQvJxwNO$_8wl04w8isVPA.__coverage__) { __cov_tQvJxwNO$_8wl04w8isVPA.__coverage__ = {}; }
__cov_tQvJxwNO$_8wl04w8isVPA = __cov_tQvJxwNO$_8wl04w8isVPA.__coverage__;
if (!(__cov_tQvJxwNO$_8wl04w8isVPA['build/moodle-atto_panoptoltibutton-button/moodle-atto_panoptoltibutton-button.js'])) {
   __cov_tQvJxwNO$_8wl04w8isVPA['build/moodle-atto_panoptoltibutton-button/moodle-atto_panoptoltibutton-button.js'] = {"path":"build/moodle-atto_panoptoltibutton-button/moodle-atto_panoptoltibutton-button.js","s":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0,0,0,0,0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},"fnMap":{"1":{"name":"(anonymous_1)","line":1,"loc":{"start":{"line":1,"column":47},"end":{"line":1,"column":66}}},"2":{"name":"(anonymous_2)","line":37,"loc":{"start":{"line":37,"column":66},"end":{"line":37,"column":78}}},"3":{"name":"(anonymous_3)","line":39,"loc":{"start":{"line":39,"column":23},"end":{"line":39,"column":69}}},"4":{"name":"(anonymous_4)","line":74,"loc":{"start":{"line":74,"column":74},"end":{"line":75,"column":38}}},"5":{"name":"(anonymous_5)","line":192,"loc":{"start":{"line":192,"column":18},"end":{"line":192,"column":30}}},"6":{"name":"(anonymous_6)","line":198,"loc":{"start":{"line":198,"column":65},"end":{"line":199,"column":30}}},"7":{"name":"(anonymous_7)","line":220,"loc":{"start":{"line":220,"column":18},"end":{"line":220,"column":30}}},"8":{"name":"(anonymous_8)","line":266,"loc":{"start":{"line":266,"column":22},"end":{"line":266,"column":37}}},"9":{"name":"(anonymous_9)","line":271,"loc":{"start":{"line":271,"column":31},"end":{"line":271,"column":50}}},"10":{"name":"(anonymous_10)","line":276,"loc":{"start":{"line":276,"column":21},"end":{"line":276,"column":39}}},"11":{"name":"(anonymous_11)","line":291,"loc":{"start":{"line":291,"column":14},"end":{"line":291,"column":37}}},"12":{"name":"(anonymous_12)","line":298,"loc":{"start":{"line":298,"column":51},"end":{"line":298,"column":78}}},"13":{"name":"(anonymous_13)","line":338,"loc":{"start":{"line":338,"column":17},"end":{"line":338,"column":33}}},"14":{"name":"(anonymous_14)","line":346,"loc":{"start":{"line":346,"column":38},"end":{"line":346,"column":54}}},"15":{"name":"(anonymous_15)","line":347,"loc":{"start":{"line":347,"column":19},"end":{"line":347,"column":31}}},"16":{"name":"(anonymous_16)","line":361,"loc":{"start":{"line":361,"column":38},"end":{"line":361,"column":54}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":373,"column":61}},"2":{"start":{"line":37,"column":0},"end":{"line":72,"column":2}},"3":{"start":{"line":39,"column":4},"end":{"line":71,"column":6}},"4":{"start":{"line":41,"column":8},"end":{"line":41,"column":87}},"5":{"start":{"line":43,"column":8},"end":{"line":66,"column":9}},"6":{"start":{"line":45,"column":12},"end":{"line":45,"column":78}},"7":{"start":{"line":47,"column":12},"end":{"line":65,"column":13}},"8":{"start":{"line":49,"column":16},"end":{"line":64,"column":17}},"9":{"start":{"line":51,"column":24},"end":{"line":51,"column":90}},"10":{"start":{"line":52,"column":24},"end":{"line":52,"column":30}},"11":{"start":{"line":58,"column":24},"end":{"line":58,"column":99}},"12":{"start":{"line":59,"column":24},"end":{"line":59,"column":30}},"13":{"start":{"line":61,"column":24},"end":{"line":62,"column":83}},"14":{"start":{"line":63,"column":24},"end":{"line":63,"column":30}},"15":{"start":{"line":68,"column":8},"end":{"line":68,"column":77}},"16":{"start":{"line":70,"column":8},"end":{"line":70,"column":24}},"17":{"start":{"line":74,"column":0},"end":{"line":196,"column":2}},"18":{"start":{"line":77,"column":4},"end":{"line":86,"column":16}},"19":{"start":{"line":89,"column":4},"end":{"line":91,"column":5}},"20":{"start":{"line":90,"column":8},"end":{"line":90,"column":54}},"21":{"start":{"line":93,"column":4},"end":{"line":95,"column":5}},"22":{"start":{"line":94,"column":8},"end":{"line":94,"column":43}},"23":{"start":{"line":97,"column":4},"end":{"line":97,"column":25}},"24":{"start":{"line":98,"column":4},"end":{"line":116,"column":5}},"25":{"start":{"line":99,"column":8},"end":{"line":101,"column":9}},"26":{"start":{"line":100,"column":12},"end":{"line":100,"column":57}},"27":{"start":{"line":103,"column":8},"end":{"line":105,"column":9}},"28":{"start":{"line":104,"column":12},"end":{"line":104,"column":59}},"29":{"start":{"line":107,"column":8},"end":{"line":110,"column":9}},"30":{"start":{"line":109,"column":12},"end":{"line":109,"column":99}},"31":{"start":{"line":112,"column":8},"end":{"line":112,"column":61}},"32":{"start":{"line":115,"column":8},"end":{"line":115,"column":84}},"33":{"start":{"line":119,"column":4},"end":{"line":158,"column":6}},"34":{"start":{"line":160,"column":4},"end":{"line":190,"column":5}},"35":{"start":{"line":162,"column":12},"end":{"line":173,"column":13}},"36":{"start":{"line":164,"column":16},"end":{"line":169,"column":19}},"37":{"start":{"line":172,"column":16},"end":{"line":172,"column":57}},"38":{"start":{"line":174,"column":12},"end":{"line":174,"column":18}},"39":{"start":{"line":176,"column":12},"end":{"line":186,"column":15}},"40":{"start":{"line":187,"column":12},"end":{"line":187,"column":18}},"41":{"start":{"line":189,"column":12},"end":{"line":189,"column":38}},"42":{"start":{"line":192,"column":4},"end":{"line":194,"column":6}},"43":{"start":{"line":193,"column":8},"end":{"line":193,"column":23}},"44":{"start":{"line":198,"column":0},"end":{"line":229,"column":2}},"45":{"start":{"line":201,"column":4},"end":{"line":201,"column":17}},"46":{"start":{"line":205,"column":4},"end":{"line":208,"column":5}},"47":{"start":{"line":207,"column":8},"end":{"line":207,"column":33}},"48":{"start":{"line":210,"column":4},"end":{"line":218,"column":14}},"49":{"start":{"line":220,"column":4},"end":{"line":228,"column":6}},"50":{"start":{"line":221,"column":8},"end":{"line":227,"column":11}},"51":{"start":{"line":266,"column":0},"end":{"line":284,"column":3}},"52":{"start":{"line":268,"column":4},"end":{"line":269,"column":81}},"53":{"start":{"line":271,"column":4},"end":{"line":273,"column":7}},"54":{"start":{"line":272,"column":8},"end":{"line":272,"column":31}},"55":{"start":{"line":275,"column":4},"end":{"line":282,"column":6}},"56":{"start":{"line":277,"column":12},"end":{"line":277,"column":32}},"57":{"start":{"line":278,"column":12},"end":{"line":280,"column":13}},"58":{"start":{"line":279,"column":16},"end":{"line":279,"column":41}},"59":{"start":{"line":286,"column":0},"end":{"line":371,"column":3}},"60":{"start":{"line":292,"column":8},"end":{"line":292,"column":31}},"61":{"start":{"line":293,"column":8},"end":{"line":296,"column":36}},"62":{"start":{"line":298,"column":8},"end":{"line":314,"column":10}},"63":{"start":{"line":299,"column":12},"end":{"line":301,"column":13}},"64":{"start":{"line":300,"column":16},"end":{"line":300,"column":23}},"65":{"start":{"line":303,"column":12},"end":{"line":309,"column":13}},"66":{"start":{"line":304,"column":16},"end":{"line":304,"column":56}},"67":{"start":{"line":305,"column":16},"end":{"line":305,"column":95}},"68":{"start":{"line":306,"column":16},"end":{"line":306,"column":97}},"69":{"start":{"line":307,"column":16},"end":{"line":307,"column":45}},"70":{"start":{"line":308,"column":16},"end":{"line":308,"column":61}},"71":{"start":{"line":310,"column":12},"end":{"line":310,"column":33}},"72":{"start":{"line":311,"column":12},"end":{"line":311,"column":34}},"73":{"start":{"line":312,"column":12},"end":{"line":312,"column":25}},"74":{"start":{"line":313,"column":12},"end":{"line":313,"column":28}},"75":{"start":{"line":316,"column":8},"end":{"line":331,"column":11}},"76":{"start":{"line":333,"column":8},"end":{"line":333,"column":70}},"77":{"start":{"line":334,"column":8},"end":{"line":334,"column":28}},"78":{"start":{"line":339,"column":8},"end":{"line":341,"column":9}},"79":{"start":{"line":340,"column":12},"end":{"line":340,"column":19}},"80":{"start":{"line":343,"column":8},"end":{"line":343,"column":35}},"81":{"start":{"line":346,"column":8},"end":{"line":350,"column":30}},"82":{"start":{"line":347,"column":12},"end":{"line":349,"column":14}},"83":{"start":{"line":348,"column":16},"end":{"line":348,"column":59}},"84":{"start":{"line":352,"column":8},"end":{"line":367,"column":11}},"85":{"start":{"line":362,"column":16},"end":{"line":365,"column":18}}},"branchMap":{"1":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":8},"end":{"line":43,"column":8}},{"start":{"line":43,"column":8},"end":{"line":43,"column":8}}]},"2":{"line":43,"type":"binary-expr","locations":[{"start":{"line":43,"column":12},"end":{"line":43,"column":67}},{"start":{"line":44,"column":19},"end":{"line":44,"column":39}}]},"3":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":12},"end":{"line":47,"column":12}},{"start":{"line":47,"column":12},"end":{"line":47,"column":12}}]},"4":{"line":49,"type":"switch","locations":[{"start":{"line":50,"column":20},"end":{"line":52,"column":30}},{"start":{"line":53,"column":20},"end":{"line":53,"column":33}},{"start":{"line":54,"column":20},"end":{"line":54,"column":33}},{"start":{"line":55,"column":20},"end":{"line":55,"column":34}},{"start":{"line":56,"column":20},"end":{"line":56,"column":33}},{"start":{"line":57,"column":20},"end":{"line":59,"column":30}},{"start":{"line":60,"column":20},"end":{"line":63,"column":30}}]},"5":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":4},"end":{"line":89,"column":4}},{"start":{"line":89,"column":4},"end":{"line":89,"column":4}}]},"6":{"line":89,"type":"binary-expr","locations":[{"start":{"line":89,"column":8},"end":{"line":89,"column":18}},{"start":{"line":89,"column":22},"end":{"line":89,"column":39}}]},"7":{"line":93,"type":"if","locations":[{"start":{"line":93,"column":4},"end":{"line":93,"column":4}},{"start":{"line":93,"column":4},"end":{"line":93,"column":4}}]},"8":{"line":98,"type":"if","locations":[{"start":{"line":98,"column":4},"end":{"line":98,"column":4}},{"start":{"line":98,"column":4},"end":{"line":98,"column":4}}]},"9":{"line":99,"type":"if","locations":[{"start":{"line":99,"column":8},"end":{"line":99,"column":8}},{"start":{"line":99,"column":8},"end":{"line":99,"column":8}}]},"10":{"line":103,"type":"if","locations":[{"start":{"line":103,"column":8},"end":{"line":103,"column":8}},{"start":{"line":103,"column":8},"end":{"line":103,"column":8}}]},"11":{"line":107,"type":"if","locations":[{"start":{"line":107,"column":8},"end":{"line":107,"column":8}},{"start":{"line":107,"column":8},"end":{"line":107,"column":8}}]},"12":{"line":115,"type":"cond-expr","locations":[{"start":{"line":115,"column":42},"end":{"line":115,"column":59}},{"start":{"line":115,"column":62},"end":{"line":115,"column":83}}]},"13":{"line":130,"type":"cond-expr","locations":[{"start":{"line":130,"column":43},"end":{"line":130,"column":73}},{"start":{"line":130,"column":76},"end":{"line":130,"column":78}}]},"14":{"line":146,"type":"cond-expr","locations":[{"start":{"line":146,"column":45},"end":{"line":146,"column":68}},{"start":{"line":146,"column":71},"end":{"line":146,"column":73}}]},"15":{"line":154,"type":"cond-expr","locations":[{"start":{"line":154,"column":39},"end":{"line":154,"column":69}},{"start":{"line":154,"column":72},"end":{"line":154,"column":74}}]},"16":{"line":160,"type":"switch","locations":[{"start":{"line":161,"column":8},"end":{"line":174,"column":18}},{"start":{"line":175,"column":8},"end":{"line":187,"column":18}},{"start":{"line":188,"column":8},"end":{"line":189,"column":38}}]},"17":{"line":162,"type":"if","locations":[{"start":{"line":162,"column":12},"end":{"line":162,"column":12}},{"start":{"line":162,"column":12},"end":{"line":162,"column":12}}]},"18":{"line":205,"type":"if","locations":[{"start":{"line":205,"column":4},"end":{"line":205,"column":4}},{"start":{"line":205,"column":4},"end":{"line":205,"column":4}}]},"19":{"line":205,"type":"binary-expr","locations":[{"start":{"line":205,"column":8},"end":{"line":205,"column":33}},{"start":{"line":205,"column":37},"end":{"line":206,"column":47}}]},"20":{"line":299,"type":"if","locations":[{"start":{"line":299,"column":12},"end":{"line":299,"column":12}},{"start":{"line":299,"column":12},"end":{"line":299,"column":12}}]},"21":{"line":339,"type":"if","locations":[{"start":{"line":339,"column":8},"end":{"line":339,"column":8}},{"start":{"line":339,"column":8},"end":{"line":339,"column":8}}]},"22":{"line":339,"type":"binary-expr","locations":[{"start":{"line":339,"column":12},"end":{"line":339,"column":27}},{"start":{"line":339,"column":31},"end":{"line":339,"column":58}}]}},"code":["(function () { YUI.add('moodle-atto_panoptoltibutton-button', function (Y, NAME) {","","// This file is part of Moodle - http://moodle.org/","//","// Moodle is free software: you can redistribute it and/or modify","// it under the terms of the GNU General Public License as published by","// the Free Software Foundation, either version 3 of the License, or","// (at your option) any later version.","//","// Moodle is distributed in the hope that it will be useful,","// but WITHOUT ANY WARRANTY; without even the implied warranty of","// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the","// GNU General Public License for more details.","//","// You should have received a copy of the GNU General Public License","// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.","","/**"," * @package     atto_panoptoltibutton"," * @copyright   2020 Panopto"," * @license     GPL v3"," */","","/**"," * @module moodle-atto_panoptoltibutton-button"," */","","/**"," * Atto text editor LTI activities plugin"," *"," * @namespace M.atto_panoptoltibutton"," * @class     Button"," * @extends   M.editor_atto.EditorPlugin"," */","","","Y.namespace('M.atto_panoptoltibutton').PlacementStrategyFactory = function () {","","    this.strategyFor = function (item, course, resourceLinkId, tool) {","","        var StrategyClass = Y.M.atto_panoptoltibutton.EmbeddedContentRenderingStrategy;","","        if (item.mediaType === 'application/vnd.ims.lti.v1.ltilink'","                || item.placementAdvice) {","            StrategyClass = Y.M.atto_panoptoltibutton.IframeRenderingStrategy;","","            if (item.placementAdvice) {","","                switch (item.placementAdvice.presentationDocumentTarget) {","                    case 'iframe':","                        StrategyClass = Y.M.atto_panoptoltibutton.IframeRenderingStrategy;","                        break;","                    case 'embed':","                    case 'frame':","                    case 'window':","                    case 'popup':","                    case 'overlay':","                        StrategyClass = Y.M.atto_panoptoltibutton.EmbeddedContentRenderingStrategy;","                        break;","                    default:","                        alert('Unsupported presentation target: '","                                + item.placementAdvice.presentationDocumentTarget);","                        break;","                }","            }","        }","","        var strategy = new StrategyClass(item, course, resourceLinkId, tool);","","        return strategy;","    };","};","","Y.namespace('M.atto_panoptoltibutton').EmbeddedContentRenderingStrategy = function (item,","        course, resourceLinkId, tool) {","","    var mimeTypePieces = item.mediaType.split(\"/\"),","        mimeTypeType = mimeTypePieces[0],","        defaultHeight = \"250px\",","        defaultThumbnailWidth = 128,","        defaultThumbnailHeight = 72,","        titleHeight = defaultThumbnailHeight,","        titleWidth = null,","        textHeight = (parseInt(defaultHeight) - parseInt(defaultThumbnailHeight)) + \"px\",","        TEMPLATES,","        content;","","    // In this case there is no text/html being sent, just a title and possible thumbnail, reduce height.","    if (!item.text || !item.text.length) {","        defaultHeight = defaultThumbnailHeight + \"px\";","    }","","    if (!item.displayHeight) {","        item.displayHeight = defaultHeight;","    }","","    var thumbnailId = '';","    if (item.thumbnail) {","        if (!item.thumbnail.width) {","            item.thumbnail.width = defaultThumbnailWidth;","        }","","        if (!item.thumbnail.height) {","            item.thumbnail.height = defaultThumbnailHeight;","        }","","        if (item.displayWidth) {","            // The extra 5px is for a margin to the right of the thumbnail","            titleWidth = (parseInt(item.displayWidth) - parseInt(item.thumbnail.width) - 5) + \"px\";","        }","","        titleHeight = parseInt(item.thumbnail.height) + \"px\";","","        // LTI 1.3 sends thumbnail id as @id.","        thumbnailId = item.thumbnail.id ? item.thumbnail.id : item.thumbnail[\"@id\"];","    }","","","    TEMPLATES = {","        ltiLink: Y.Handlebars.compile('<iframe src=\"' + M.cfg.wwwroot + '/lib/editor/atto/plugins/panoptoltibutton/view.php?custom={{custom}}&'","            + 'course={{course.id}}&ltitypeid={{toolid}}&resourcelinkid={{resourcelinkid}}'","            + '{{#if item.url}}&contenturl={{item.url}}{{/if}}'","            + '\" '","            + '{{#if item.placementAdvice.width}} width=\"{{item.placementAdvice.displayWidth}}\"{{/if}} '","            + '{{#if item.placementAdvice.height}} height=\"{{item.placementAdvice.displayHeight}}\"{{/if}} '","            + 'allowfullscreen=\"true\" '","            + '/>'","        ),","        link: Y.Handlebars.compile('<div style=\"'","                    + (item.displayWidth ? 'width:{{item.displayWidth}};' : '')","                    + 'height:{{titleHeight}};\">'","                    + '<a href=\"' + M.cfg.wwwroot + '/lib/editor/atto/plugins/panoptoltibutton/view.php?custom={{custom}}&'","                    + 'course={{course.id}}&ltitypeid={{toolid}}&resourcelinkid={{resourcelinkid}}'","                    + '{{#if item.url}}&contenturl={{item.url}}{{/if}}'","                    + '\" '","                    + '{{#if item.placementAdvice.windowTarget}}target=\"{{item.placementAdvice.windowTarget}}\" {{/if}}'","                    + '>'","                        + '{{#if item.thumbnail}}'","                        + '<img src={{thumbnailId}} alt=\"content thumbnail\"'","                        + 'style=\"float:left;margin-right:5px;'","                        + 'width:{{item.thumbnail.width}}px;'","                        + 'height:{{item.thumbnail.height}}px;'","                        + '\" /> '","                        + '{{/if}}'","                        + '<div style=\"float:left;font-size:20px;font-weight:bold;'","                        + (item.titleWidth ? 'width:{{titleWidth}};' : '')","                        + 'height:{{titleHeight}};line-height:{{titleHeight}};\">'","                        + '{{item.title}}'","                        + '</div>'","                    + '</a>'","                + '</div>'","                + '{{#if item.text}}'","                + '<div style=\"'","                + (item.displayWidth ? 'width:{{item.displayWidth}};' : '')","                + 'min-height:{{textHeight}};\"></span>{{item.text}}</span></div>'","                + '{{/if}}'","        )","    };","","    switch (mimeTypeType) {","        case 'application':","            if (mimeTypePieces[1] === 'vnd.ims.lti.v1.ltilink') {","","                content = TEMPLATES.ltiLink({","                    item: item,","                    toolid: tool.id,","                    resourcelinkid: resourceLinkId,","                    course: course,","                });","            }","            else {","                alert('Unsupported application subtype');","            }","            break;","        case 'text':","            content = TEMPLATES.link({","                item: item,","                custom: encodeURIComponent(JSON.stringify(item.custom)),","                course: course,","                toolid: tool.id,","                resourcelnkid: resourceLinkId,","                textHeight: textHeight,","                titleHeight: titleHeight,","                titleWidth: titleWidth,","                thumbnailId: thumbnailId","            });","            break;","        default:","            alert('Unsupported type');","    }","","    this.toHtml = function () {","        return content;","    };","","};","","Y.namespace('M.atto_panoptoltibutton').IframeRenderingStrategy = function (item, course,","        resourceLinkId, tool) {","","    var template;","","    // If the item URL is the same as the LTI Launch URL (or Content-Item request), we assume we need","    // to make an LTI Launch request.","    if (item.url !== tool.baseurl && item.url !== tool.config.","            toolurl_ContentItemSelectionRequest) {","        item.useCustomUrl = true;","    }","","    template = Y.Handlebars.compile('<iframe src=\"' + M.cfg.wwwroot + '/lib/editor/atto/plugins/panoptoltibutton/view.php?course={{courseId}}'","            + '&ltitypeid={{ltiTypeId}}&custom={{custom}}'","            + '{{#if item.useCustomUrl}}&contenturl={{item.url}}{{/if}}'","            + '&resourcelinkid={{resourcelinkid}}\" '","            + ' {{#if item.placementAdvice.displayWidth}}width=\"{{item.placementAdvice.displayWidth}}\" {{/if}}'","            + ' {{#if item.placementAdvice.displayHeight}}height=\"{{item.placementAdvice.displayHeight}}\" {{/if}}'","            + 'allowfullscreen=\"true\" '","            + '></iframe>'","            );","","    this.toHtml = function () {","        return template({","            item: item,","            custom: JSON.stringify(item.custom),","            courseId: course.id,","            resourcelinkid: resourceLinkId,","            ltiTypeId: tool.id","        });","    };","};","// This file is part of Moodle - http://moodle.org/","//","// Moodle is free software: you can redistribute it and/or modify","// it under the terms of the GNU General Public License as published by","// the Free Software Foundation, either version 3 of the License, or","// (at your option) any later version.","//","// Moodle is distributed in the hope that it will be useful,","// but WITHOUT ANY WARRANTY; without even the implied warranty of","// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the","// GNU General Public License for more details.","//","// You should have received a copy of the GNU General Public License","// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.","","/**"," * @package     atto_panoptoltibutton"," * @copyright   2020 Panopto"," * @license     GPL v3"," */","","","/**"," * @module moodle-atto_panoptoltibutton-button"," */","","","/**"," * Atto text editor Panopto LTI plugin"," *"," * @namespace M.atto_panoptoltibutton"," * @class     Button"," * @extends    M.editor_atto.EditorPlugin"," */","","","require(['core/str'], function (str) {","","    var errorMessage = null,","        stringPromise = str.get_string('erroroccurred', 'atto_panoptoltibutton');","","    $.when(stringPromise).done(function (invalid) {","        errorMessage = invalid;","    });","","    document.CALLBACKS = {","        handleError: function (errors) {","            alert(errorMessage);","            for (var i = 0; i < errors.length; i++) {","                console.error(errors[i]);","            }","        }","    };","","});","","Y.namespace('M.atto_panoptoltibutton').Button = Y.Base.create('button', Y.M.editor_atto.EditorPlugin, [], {","    _CONTENT_ITEM_SELECTION_URL: M.cfg.wwwroot + '/lib/editor/atto/plugins/panoptoltibutton/contentitem.php',","","    _panel: null,","","    _addTool: function (event, tool) {","        event.preventDefault();","        var resourceLinkId = this._createResourceLinkId(),","            host = this.get('host'),","            panel,","            courseid = this._course;","","        document.CALLBACKS['f' + resourceLinkId] = function (contentItemData) {","            if (!contentItemData) {","                return;","            }","","            for (var i = 0; i < contentItemData['@graph'].length; i++) {","                var item = contentItemData['@graph'][i];","                var strategyFactory = new Y.M.atto_panoptoltibutton.PlacementStrategyFactory();","                var strategy = strategyFactory.strategyFor(item, courseid, resourceLinkId, tool);","                var render = strategy.toHtml;","                host.insertContentAtFocusPoint(render(item));","            }","            host.saveSelection();","            host.updateOriginal();","            panel.hide();","            panel.destroy();","        };","","        this._panel = new M.core.dialogue({","            bodyContent: '<iframe src=\"' + this._CONTENT_ITEM_SELECTION_URL +","                '?course=' + this._course.id +","                '&id=' + tool.id +","                '&callback=f' + resourceLinkId +","                '\" width=\"100%\" height=\"100%\"></iframe>',","            headerContent: tool.name,","            width: '67%',","            height: '66%',","            draggable: false,","            visible: true,","            zindex: 100,","            modal: true,","            focusOnPreviousTargetAfterHide: true,","            render: true","        });","","        this._panel.after('visibleChange', this._panel.destroy, this);","        panel = this._panel;","","    },","","    initializer: function (args) {","        if (!args.toolTypes || args.toolTypes.length === 0) {","            return;","        }","","        this._course = args.course;","","","        this._createResourceLinkId = (function (base) {","            return function () {","                return base + '_' + (new Date()).getTime();","            };","        }(args.resourcebase));","","        this.addToolbarMenu({","","            icon: 'ed/iconone',","            iconComponent: 'atto_panoptoltibutton',","","            globalItemConfig:{","                callback: this._addTool","            },","","            items: args.toolTypes.map(function (args) {","                return {","                    text : args.name,","                    callbackArgs: args","                };","            })","        });","","    }","","});","","}, '@VERSION@', {\"requires\": [\"moodle-editor_atto-plugin\"]});","","}());"]};
}
__cov_tQvJxwNO$_8wl04w8isVPA = __cov_tQvJxwNO$_8wl04w8isVPA['build/moodle-atto_panoptoltibutton-button/moodle-atto_panoptoltibutton-button.js'];
__cov_tQvJxwNO$_8wl04w8isVPA.s['1']++;YUI.add('moodle-atto_panoptoltibutton-button',function(Y,NAME){__cov_tQvJxwNO$_8wl04w8isVPA.f['1']++;__cov_tQvJxwNO$_8wl04w8isVPA.s['2']++;Y.namespace('M.atto_panoptoltibutton').PlacementStrategyFactory=function(){__cov_tQvJxwNO$_8wl04w8isVPA.f['2']++;__cov_tQvJxwNO$_8wl04w8isVPA.s['3']++;this.strategyFor=function(item,course,resourceLinkId,tool){__cov_tQvJxwNO$_8wl04w8isVPA.f['3']++;__cov_tQvJxwNO$_8wl04w8isVPA.s['4']++;var StrategyClass=Y.M.atto_panoptoltibutton.EmbeddedContentRenderingStrategy;__cov_tQvJxwNO$_8wl04w8isVPA.s['5']++;if((__cov_tQvJxwNO$_8wl04w8isVPA.b['2'][0]++,item.mediaType==='application/vnd.ims.lti.v1.ltilink')||(__cov_tQvJxwNO$_8wl04w8isVPA.b['2'][1]++,item.placementAdvice)){__cov_tQvJxwNO$_8wl04w8isVPA.b['1'][0]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['6']++;StrategyClass=Y.M.atto_panoptoltibutton.IframeRenderingStrategy;__cov_tQvJxwNO$_8wl04w8isVPA.s['7']++;if(item.placementAdvice){__cov_tQvJxwNO$_8wl04w8isVPA.b['3'][0]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['8']++;switch(item.placementAdvice.presentationDocumentTarget){case'iframe':__cov_tQvJxwNO$_8wl04w8isVPA.b['4'][0]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['9']++;StrategyClass=Y.M.atto_panoptoltibutton.IframeRenderingStrategy;__cov_tQvJxwNO$_8wl04w8isVPA.s['10']++;break;case'embed':__cov_tQvJxwNO$_8wl04w8isVPA.b['4'][1]++;case'frame':__cov_tQvJxwNO$_8wl04w8isVPA.b['4'][2]++;case'window':__cov_tQvJxwNO$_8wl04w8isVPA.b['4'][3]++;case'popup':__cov_tQvJxwNO$_8wl04w8isVPA.b['4'][4]++;case'overlay':__cov_tQvJxwNO$_8wl04w8isVPA.b['4'][5]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['11']++;StrategyClass=Y.M.atto_panoptoltibutton.EmbeddedContentRenderingStrategy;__cov_tQvJxwNO$_8wl04w8isVPA.s['12']++;break;default:__cov_tQvJxwNO$_8wl04w8isVPA.b['4'][6]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['13']++;alert('Unsupported presentation target: '+item.placementAdvice.presentationDocumentTarget);__cov_tQvJxwNO$_8wl04w8isVPA.s['14']++;break;}}else{__cov_tQvJxwNO$_8wl04w8isVPA.b['3'][1]++;}}else{__cov_tQvJxwNO$_8wl04w8isVPA.b['1'][1]++;}__cov_tQvJxwNO$_8wl04w8isVPA.s['15']++;var strategy=new StrategyClass(item,course,resourceLinkId,tool);__cov_tQvJxwNO$_8wl04w8isVPA.s['16']++;return strategy;};};__cov_tQvJxwNO$_8wl04w8isVPA.s['17']++;Y.namespace('M.atto_panoptoltibutton').EmbeddedContentRenderingStrategy=function(item,course,resourceLinkId,tool){__cov_tQvJxwNO$_8wl04w8isVPA.f['4']++;__cov_tQvJxwNO$_8wl04w8isVPA.s['18']++;var mimeTypePieces=item.mediaType.split('/'),mimeTypeType=mimeTypePieces[0],defaultHeight='250px',defaultThumbnailWidth=128,defaultThumbnailHeight=72,titleHeight=defaultThumbnailHeight,titleWidth=null,textHeight=parseInt(defaultHeight)-parseInt(defaultThumbnailHeight)+'px',TEMPLATES,content;__cov_tQvJxwNO$_8wl04w8isVPA.s['19']++;if((__cov_tQvJxwNO$_8wl04w8isVPA.b['6'][0]++,!item.text)||(__cov_tQvJxwNO$_8wl04w8isVPA.b['6'][1]++,!item.text.length)){__cov_tQvJxwNO$_8wl04w8isVPA.b['5'][0]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['20']++;defaultHeight=defaultThumbnailHeight+'px';}else{__cov_tQvJxwNO$_8wl04w8isVPA.b['5'][1]++;}__cov_tQvJxwNO$_8wl04w8isVPA.s['21']++;if(!item.displayHeight){__cov_tQvJxwNO$_8wl04w8isVPA.b['7'][0]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['22']++;item.displayHeight=defaultHeight;}else{__cov_tQvJxwNO$_8wl04w8isVPA.b['7'][1]++;}__cov_tQvJxwNO$_8wl04w8isVPA.s['23']++;var thumbnailId='';__cov_tQvJxwNO$_8wl04w8isVPA.s['24']++;if(item.thumbnail){__cov_tQvJxwNO$_8wl04w8isVPA.b['8'][0]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['25']++;if(!item.thumbnail.width){__cov_tQvJxwNO$_8wl04w8isVPA.b['9'][0]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['26']++;item.thumbnail.width=defaultThumbnailWidth;}else{__cov_tQvJxwNO$_8wl04w8isVPA.b['9'][1]++;}__cov_tQvJxwNO$_8wl04w8isVPA.s['27']++;if(!item.thumbnail.height){__cov_tQvJxwNO$_8wl04w8isVPA.b['10'][0]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['28']++;item.thumbnail.height=defaultThumbnailHeight;}else{__cov_tQvJxwNO$_8wl04w8isVPA.b['10'][1]++;}__cov_tQvJxwNO$_8wl04w8isVPA.s['29']++;if(item.displayWidth){__cov_tQvJxwNO$_8wl04w8isVPA.b['11'][0]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['30']++;titleWidth=parseInt(item.displayWidth)-parseInt(item.thumbnail.width)-5+'px';}else{__cov_tQvJxwNO$_8wl04w8isVPA.b['11'][1]++;}__cov_tQvJxwNO$_8wl04w8isVPA.s['31']++;titleHeight=parseInt(item.thumbnail.height)+'px';__cov_tQvJxwNO$_8wl04w8isVPA.s['32']++;thumbnailId=item.thumbnail.id?(__cov_tQvJxwNO$_8wl04w8isVPA.b['12'][0]++,item.thumbnail.id):(__cov_tQvJxwNO$_8wl04w8isVPA.b['12'][1]++,item.thumbnail['@id']);}else{__cov_tQvJxwNO$_8wl04w8isVPA.b['8'][1]++;}__cov_tQvJxwNO$_8wl04w8isVPA.s['33']++;TEMPLATES={ltiLink:Y.Handlebars.compile('<iframe src="'+M.cfg.wwwroot+'/lib/editor/atto/plugins/panoptoltibutton/view.php?custom={{custom}}&'+'course={{course.id}}&ltitypeid={{toolid}}&resourcelinkid={{resourcelinkid}}'+'{{#if item.url}}&contenturl={{item.url}}{{/if}}'+'" '+'{{#if item.placementAdvice.width}} width="{{item.placementAdvice.displayWidth}}"{{/if}} '+'{{#if item.placementAdvice.height}} height="{{item.placementAdvice.displayHeight}}"{{/if}} '+'allowfullscreen="true" '+'/>'),link:Y.Handlebars.compile('<div style="'+(item.displayWidth?(__cov_tQvJxwNO$_8wl04w8isVPA.b['13'][0]++,'width:{{item.displayWidth}};'):(__cov_tQvJxwNO$_8wl04w8isVPA.b['13'][1]++,''))+'height:{{titleHeight}};">'+'<a href="'+M.cfg.wwwroot+'/lib/editor/atto/plugins/panoptoltibutton/view.php?custom={{custom}}&'+'course={{course.id}}&ltitypeid={{toolid}}&resourcelinkid={{resourcelinkid}}'+'{{#if item.url}}&contenturl={{item.url}}{{/if}}'+'" '+'{{#if item.placementAdvice.windowTarget}}target="{{item.placementAdvice.windowTarget}}" {{/if}}'+'>'+'{{#if item.thumbnail}}'+'<img src={{thumbnailId}} alt="content thumbnail"'+'style="float:left;margin-right:5px;'+'width:{{item.thumbnail.width}}px;'+'height:{{item.thumbnail.height}}px;'+'" /> '+'{{/if}}'+'<div style="float:left;font-size:20px;font-weight:bold;'+(item.titleWidth?(__cov_tQvJxwNO$_8wl04w8isVPA.b['14'][0]++,'width:{{titleWidth}};'):(__cov_tQvJxwNO$_8wl04w8isVPA.b['14'][1]++,''))+'height:{{titleHeight}};line-height:{{titleHeight}};">'+'{{item.title}}'+'</div>'+'</a>'+'</div>'+'{{#if item.text}}'+'<div style="'+(item.displayWidth?(__cov_tQvJxwNO$_8wl04w8isVPA.b['15'][0]++,'width:{{item.displayWidth}};'):(__cov_tQvJxwNO$_8wl04w8isVPA.b['15'][1]++,''))+'min-height:{{textHeight}};"></span>{{item.text}}</span></div>'+'{{/if}}')};__cov_tQvJxwNO$_8wl04w8isVPA.s['34']++;switch(mimeTypeType){case'application':__cov_tQvJxwNO$_8wl04w8isVPA.b['16'][0]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['35']++;if(mimeTypePieces[1]==='vnd.ims.lti.v1.ltilink'){__cov_tQvJxwNO$_8wl04w8isVPA.b['17'][0]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['36']++;content=TEMPLATES.ltiLink({item:item,toolid:tool.id,resourcelinkid:resourceLinkId,course:course});}else{__cov_tQvJxwNO$_8wl04w8isVPA.b['17'][1]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['37']++;alert('Unsupported application subtype');}__cov_tQvJxwNO$_8wl04w8isVPA.s['38']++;break;case'text':__cov_tQvJxwNO$_8wl04w8isVPA.b['16'][1]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['39']++;content=TEMPLATES.link({item:item,custom:encodeURIComponent(JSON.stringify(item.custom)),course:course,toolid:tool.id,resourcelnkid:resourceLinkId,textHeight:textHeight,titleHeight:titleHeight,titleWidth:titleWidth,thumbnailId:thumbnailId});__cov_tQvJxwNO$_8wl04w8isVPA.s['40']++;break;default:__cov_tQvJxwNO$_8wl04w8isVPA.b['16'][2]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['41']++;alert('Unsupported type');}__cov_tQvJxwNO$_8wl04w8isVPA.s['42']++;this.toHtml=function(){__cov_tQvJxwNO$_8wl04w8isVPA.f['5']++;__cov_tQvJxwNO$_8wl04w8isVPA.s['43']++;return content;};};__cov_tQvJxwNO$_8wl04w8isVPA.s['44']++;Y.namespace('M.atto_panoptoltibutton').IframeRenderingStrategy=function(item,course,resourceLinkId,tool){__cov_tQvJxwNO$_8wl04w8isVPA.f['6']++;__cov_tQvJxwNO$_8wl04w8isVPA.s['45']++;var template;__cov_tQvJxwNO$_8wl04w8isVPA.s['46']++;if((__cov_tQvJxwNO$_8wl04w8isVPA.b['19'][0]++,item.url!==tool.baseurl)&&(__cov_tQvJxwNO$_8wl04w8isVPA.b['19'][1]++,item.url!==tool.config.toolurl_ContentItemSelectionRequest)){__cov_tQvJxwNO$_8wl04w8isVPA.b['18'][0]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['47']++;item.useCustomUrl=true;}else{__cov_tQvJxwNO$_8wl04w8isVPA.b['18'][1]++;}__cov_tQvJxwNO$_8wl04w8isVPA.s['48']++;template=Y.Handlebars.compile('<iframe src="'+M.cfg.wwwroot+'/lib/editor/atto/plugins/panoptoltibutton/view.php?course={{courseId}}'+'&ltitypeid={{ltiTypeId}}&custom={{custom}}'+'{{#if item.useCustomUrl}}&contenturl={{item.url}}{{/if}}'+'&resourcelinkid={{resourcelinkid}}" '+' {{#if item.placementAdvice.displayWidth}}width="{{item.placementAdvice.displayWidth}}" {{/if}}'+' {{#if item.placementAdvice.displayHeight}}height="{{item.placementAdvice.displayHeight}}" {{/if}}'+'allowfullscreen="true" '+'></iframe>');__cov_tQvJxwNO$_8wl04w8isVPA.s['49']++;this.toHtml=function(){__cov_tQvJxwNO$_8wl04w8isVPA.f['7']++;__cov_tQvJxwNO$_8wl04w8isVPA.s['50']++;return template({item:item,custom:JSON.stringify(item.custom),courseId:course.id,resourcelinkid:resourceLinkId,ltiTypeId:tool.id});};};__cov_tQvJxwNO$_8wl04w8isVPA.s['51']++;require(['core/str'],function(str){__cov_tQvJxwNO$_8wl04w8isVPA.f['8']++;__cov_tQvJxwNO$_8wl04w8isVPA.s['52']++;var errorMessage=null,stringPromise=str.get_string('erroroccurred','atto_panoptoltibutton');__cov_tQvJxwNO$_8wl04w8isVPA.s['53']++;$.when(stringPromise).done(function(invalid){__cov_tQvJxwNO$_8wl04w8isVPA.f['9']++;__cov_tQvJxwNO$_8wl04w8isVPA.s['54']++;errorMessage=invalid;});__cov_tQvJxwNO$_8wl04w8isVPA.s['55']++;document.CALLBACKS={handleError:function(errors){__cov_tQvJxwNO$_8wl04w8isVPA.f['10']++;__cov_tQvJxwNO$_8wl04w8isVPA.s['56']++;alert(errorMessage);__cov_tQvJxwNO$_8wl04w8isVPA.s['57']++;for(var i=0;i<errors.length;i++){__cov_tQvJxwNO$_8wl04w8isVPA.s['58']++;console.error(errors[i]);}}};});__cov_tQvJxwNO$_8wl04w8isVPA.s['59']++;Y.namespace('M.atto_panoptoltibutton').Button=Y.Base.create('button',Y.M.editor_atto.EditorPlugin,[],{_CONTENT_ITEM_SELECTION_URL:M.cfg.wwwroot+'/lib/editor/atto/plugins/panoptoltibutton/contentitem.php',_panel:null,_addTool:function(event,tool){__cov_tQvJxwNO$_8wl04w8isVPA.f['11']++;__cov_tQvJxwNO$_8wl04w8isVPA.s['60']++;event.preventDefault();__cov_tQvJxwNO$_8wl04w8isVPA.s['61']++;var resourceLinkId=this._createResourceLinkId(),host=this.get('host'),panel,courseid=this._course;__cov_tQvJxwNO$_8wl04w8isVPA.s['62']++;document.CALLBACKS['f'+resourceLinkId]=function(contentItemData){__cov_tQvJxwNO$_8wl04w8isVPA.f['12']++;__cov_tQvJxwNO$_8wl04w8isVPA.s['63']++;if(!contentItemData){__cov_tQvJxwNO$_8wl04w8isVPA.b['20'][0]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['64']++;return;}else{__cov_tQvJxwNO$_8wl04w8isVPA.b['20'][1]++;}__cov_tQvJxwNO$_8wl04w8isVPA.s['65']++;for(var i=0;i<contentItemData['@graph'].length;i++){__cov_tQvJxwNO$_8wl04w8isVPA.s['66']++;var item=contentItemData['@graph'][i];__cov_tQvJxwNO$_8wl04w8isVPA.s['67']++;var strategyFactory=new Y.M.atto_panoptoltibutton.PlacementStrategyFactory();__cov_tQvJxwNO$_8wl04w8isVPA.s['68']++;var strategy=strategyFactory.strategyFor(item,courseid,resourceLinkId,tool);__cov_tQvJxwNO$_8wl04w8isVPA.s['69']++;var render=strategy.toHtml;__cov_tQvJxwNO$_8wl04w8isVPA.s['70']++;host.insertContentAtFocusPoint(render(item));}__cov_tQvJxwNO$_8wl04w8isVPA.s['71']++;host.saveSelection();__cov_tQvJxwNO$_8wl04w8isVPA.s['72']++;host.updateOriginal();__cov_tQvJxwNO$_8wl04w8isVPA.s['73']++;panel.hide();__cov_tQvJxwNO$_8wl04w8isVPA.s['74']++;panel.destroy();};__cov_tQvJxwNO$_8wl04w8isVPA.s['75']++;this._panel=new M.core.dialogue({bodyContent:'<iframe src="'+this._CONTENT_ITEM_SELECTION_URL+'?course='+this._course.id+'&id='+tool.id+'&callback=f'+resourceLinkId+'" width="100%" height="100%"></iframe>',headerContent:tool.name,width:'67%',height:'66%',draggable:false,visible:true,zindex:100,modal:true,focusOnPreviousTargetAfterHide:true,render:true});__cov_tQvJxwNO$_8wl04w8isVPA.s['76']++;this._panel.after('visibleChange',this._panel.destroy,this);__cov_tQvJxwNO$_8wl04w8isVPA.s['77']++;panel=this._panel;},initializer:function(args){__cov_tQvJxwNO$_8wl04w8isVPA.f['13']++;__cov_tQvJxwNO$_8wl04w8isVPA.s['78']++;if((__cov_tQvJxwNO$_8wl04w8isVPA.b['22'][0]++,!args.toolTypes)||(__cov_tQvJxwNO$_8wl04w8isVPA.b['22'][1]++,args.toolTypes.length===0)){__cov_tQvJxwNO$_8wl04w8isVPA.b['21'][0]++;__cov_tQvJxwNO$_8wl04w8isVPA.s['79']++;return;}else{__cov_tQvJxwNO$_8wl04w8isVPA.b['21'][1]++;}__cov_tQvJxwNO$_8wl04w8isVPA.s['80']++;this._course=args.course;__cov_tQvJxwNO$_8wl04w8isVPA.s['81']++;this._createResourceLinkId=function(base){__cov_tQvJxwNO$_8wl04w8isVPA.f['14']++;__cov_tQvJxwNO$_8wl04w8isVPA.s['82']++;return function(){__cov_tQvJxwNO$_8wl04w8isVPA.f['15']++;__cov_tQvJxwNO$_8wl04w8isVPA.s['83']++;return base+'_'+new Date().getTime();};}(args.resourcebase);__cov_tQvJxwNO$_8wl04w8isVPA.s['84']++;this.addToolbarMenu({icon:'ed/iconone',iconComponent:'atto_panoptoltibutton',globalItemConfig:{callback:this._addTool},items:args.toolTypes.map(function(args){__cov_tQvJxwNO$_8wl04w8isVPA.f['16']++;__cov_tQvJxwNO$_8wl04w8isVPA.s['85']++;return{text:args.name,callbackArgs:args};})});}});},'@VERSION@',{'requires':['moodle-editor_atto-plugin']});
